---

- hosts: all
  become: yes
  
  vars_prompt:
    - name: MySQL_version
      prompt: "What MySQL version would you like installed, 55, 56, 57 or 80"
      private: no
      
  tasks:
    - name: install mysql repo
      yum:
        name: https://dev.mysql.com/get/mysql80-community-release-el7-2.noarch.rpm

    - name: disable mysql current repos
      command: /usr/bin/yum-config-manager --disable mysql8*-community && /usr/bin/yum-config-manager --disable mysql5*-community
    
    - name: enable repo for desired mysql version
      command: /usr/bin/yum-config-manager --enable mysql{{MySQL_version}}-community  
 
    - name: Stop MySQL if instance already exists
      service:
        name: mysqld
        state: stopped

    - name: Remove anyy pre-existing install
      yum:
        name: mysql*
        autoremove: no
        state: absent

    - name: install mysql server
      yum:
        name: ['mysql-community-server']
        state: latest

    - name: Extract complete_db.tgz into /var/lib/mysql
      unarchive:
        src: ~/complete_db.tgz
        dest: /var/lib/mysql

    - name: create my.cnf
      file:
        path: ~/.my.cnf
        state: touch

    - name: add lines
      blockinfile:
        path: ~/.my.cnf
        block: |
          [client]
          user=root
          password=££caish9uoYo9xaiz4

    - name: start and enable mysql
      service:
        name: mysqld
        state: started
        enabled: yes

    - name: Restart MySQL
      service:
        name: mysqld
        state: restarted
